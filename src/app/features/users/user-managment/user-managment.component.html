<div class="max-w-8xl px-4 py-10 sm:px-6 lg:px-8 mx-auto font_outfit ">
    <!-- Card -->
    <div class="bg-[#fcfdfe] rounded-3xl p-4 sm:p-7 shadow-[0_2px_6px_rgba(0,0,0,0.20)]">

        <div class="mb-8">
            <h2 class="text-xl font-semibold text-[#2d2c63] ">
                Registrar Nuevo Usuario
            </h2>
            <p class="text-sm text-[#9291aa]  mt-1">
                Completa el formulario para registrar un nuevo usuario.
            </p>
        </div>

        <form [formGroup]="userForm" (ngSubmit)="registrarUsuario()">

            <!-- Información del Usuario -->
            <div class="grid grid-cols-12 gap-y-4 sm:gap-y-6 pb-8 border-b border-[#f0f1f8] ">
                <div class="col-span-12">
                    <div class="flex items-center gap-x-5">
                        <!-- Avatar (Placeholder or Preview) -->
                        <div
                            class="relative size-20 rounded-full bg-[#f9f9fe]  flex items-center justify-center border-2 border-[#e2e3fa] ">
                            <img class="inline-block size-20 rounded-full object-cover"
                                [src]="imagenBase64Preview() || 'https://preline.co/assets/img/160x160/img1.jpg'"
                                alt="User Profile Picture">
                        </div>

                        <!-- Basic Info Inputs -->
                        <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs text-[#9291aa]  mb-1">Nombre</label>
                                <input type="text" formControlName="nombre"
                                    class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                    placeholder="Nombre"
                                    [class.border-red-500]="userForm.get('nombre')?.invalid && userForm.get('nombre')?.touched">
                                @if (userForm.get('nombre')?.invalid && userForm.get('nombre')?.touched)
                                {
                                <p class="text-xs text-red-500 mt-1">El nombre es requerido.</p>
                                }
                            </div>
                            <div>
                                <label class="block text-xs text-[#9291aa]  mb-1">Apellido</label>
                                <input type="text" formControlName="apellido"
                                    class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                    placeholder="Apellido"
                                    [class.border-red-500]="userForm.get('apellido')?.invalid && userForm.get('apellido')?.touched">
                                @if (userForm.get('apellido')?.invalid &&
                                userForm.get('apellido')?.touched) {
                                <p class="text-xs text-red-500 mt-1">El apellido es requerido.</p>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detalles de Información -->
            <div class="grid sm:grid-cols-2 gap-4 sm:gap-6 py-6 border-b border-[#f0f1f8] ">
                <!-- Información Personal -->
                <div class="space-y-4">
                    <h4 class="text-sm font-semibold text-teal-600 uppercase tracking-wide">
                        Información Personal</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">DNI /
                                Documento</label>
                            <input type="text" formControlName="documento"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('documento')?.invalid && userForm.get('documento')?.touched">
                            @if (userForm.get('documento')?.invalid &&
                            userForm.get('documento')?.touched) {
                            <p class="text-xs text-red-500 mt-1">El documento es requerido.</p>
                            }
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Teléfono</label>
                            <input type="text" formControlName="telefono"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('telefono')?.invalid && userForm.get('telefono')?.touched">
                            @if (userForm.get('telefono')?.invalid && userForm.get('telefono')?.touched)
                            {
                            <p class="text-xs text-red-500 mt-1">El teléfono es requerido.</p>
                            }
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Fecha
                                de Nacimiento</label>
                            <input type="date" formControlName="fechaNacimiento"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('fechaNacimiento')?.invalid && userForm.get('fechaNacimiento')?.touched">
                            @if (userForm.get('fechaNacimiento')?.invalid &&
                            userForm.get('fechaNacimiento')?.touched) {
                            <p class="text-xs text-red-500 mt-1">La fecha de nacimiento es requerida.
                            </p>
                            }
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Género</label>
                            <select formControlName="genero"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('genero')?.invalid && userForm.get('genero')?.touched">
                                <option value="">Seleccionar</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Otro">Otro</option>
                            </select>
                            @if (userForm.get('genero')?.invalid && userForm.get('genero')?.touched) {
                            <p class="text-xs text-red-500 mt-1">El género es requerido.</p>
                            }
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Domicilio</label>
                            <input type="text" formControlName="domicilio"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('domicilio')?.invalid && userForm.get('domicilio')?.touched">
                            @if (userForm.get('domicilio')?.invalid &&
                            userForm.get('domicilio')?.touched) {
                            <p class="text-xs text-red-500 mt-1">El domicilio es requerido.</p>
                            }
                        </div>
                    </div>
                </div>

                <!-- Información de Cuenta -->
                <div class="space-y-4">
                    <h4 class="text-sm font-semibold text-teal-600 uppercase tracking-wide">
                        Información de Cuenta</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Email</label>
                            <input type="email" formControlName="email"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('email')?.invalid && userForm.get('email')?.touched">
                            @if (userForm.get('email')?.invalid && userForm.get('email')?.touched) {
                            <p class="text-xs text-red-500 mt-1">
                                @if (userForm.get('email')?.hasError('required')) { Email requerido. }
                                @if (userForm.get('email')?.hasError('email')) { Email inválido. }
                            </p>
                            }
                        </div>

                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Contraseña</label>
                            <input type="password" formControlName="password"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('password')?.invalid && userForm.get('password')?.touched">
                            @if (userForm.get('password')?.invalid && userForm.get('password')?.touched)
                            {
                            <p class="text-xs text-red-500 mt-1">
                                @if (userForm.get('password')?.hasError('required')) { Contraseña
                                requerida. }
                                @if (userForm.get('password')?.hasError('minlength')) { Mínimo 6
                                caracteres. }
                            </p>
                            }
                        </div>

                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Turno</label>
                            <select formControlName="turno"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   "
                                [class.border-red-500]="userForm.get('turno')?.invalid && userForm.get('turno')?.touched">
                                <option value="">Seleccionar</option>
                                <option value="Mañana">Mañana</option>
                                <option value="Tarde">Tarde</option>
                                <option value="Noche">Noche</option>
                            </select>
                            <!-- Turno is optional in TS currently, so no error message unless we make it required -->
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa]  mb-1">Horas
                                de Trabajo</label>
                            <input type="text" formControlName="horasTrabajo"
                                class="py-2 px-3 block w-full border border-[#e2e3fa] rounded-lg text-sm focus:border-[#524380] focus:ring-[#524380] disabled:opacity-50 disabled:pointer-events-none   ">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección Editable - Rol -->
            <div class="py-6">
                <div class="max-w-md">
                    <h4 class="text-sm font-semibold text-teal-600 uppercase tracking-wide mb-4">
                        Configuración de Rol
                    </h4>

                    <div class="space-y-3">
                        <div>
                            <label for="rol" class="block text-sm font-medium text-teal-600 mb-2">Asignar
                                Rol</label>

                            <!-- Select -->
                            <select id="rol" name="rol" formControlName="rol"
                                class="py-2.5 px-4 block w-full border border-[#e2e3fa] rounded-xl shadow-sm focus:border-[#524380] focus:ring-2 focus:ring-[#524380]/20 transition-all duration-300 font_outfit bg-white   "
                                [class.border-red-500]="userForm.get('rol')?.invalid && userForm.get('rol')?.touched">
                                <option value="Admin">Administrador</option>
                                <option value="Pediatra">Pediatra</option>
                                <option value="Recepcio nista">Recepcionista</option>
                            </select>
                            @if (userForm.get('rol')?.invalid && userForm.get('rol')?.touched) {
                            <p class="text-xs text-red-500 mt-1">El rol es requerido.</p>
                            }
                            <!-- End Select -->
                        </div>

                        <p class="text-xs text-[#9291aa] ">
                            El rol determina los permisos y acceso del usuario en el sistema.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Sección de Botones -->
            <div class="mt-8 pt-8 border-t border-[#f0f1f8] ">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <!-- Información de estado -->
                    <div class="text-sm text-[#9291aa]  font_outfit">
                        @if (userForm.dirty) {
                        <span class="inline-flex items-center gap-1 text-[#524380] ">
                            <svg class="size-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"
                                    clip-rule="evenodd" />
                            </svg>
                            Cambios pendientes
                        </span>
                        }
                    </div>

                    <!-- Contenedor de Botones -->
                    <div class="flex gap-3">
                        <!-- Botón Volver -->
                        <button routerLink="/administracion/gestion-usuarios" type="button" [disabled]="isSubmitting()"
                            class="py-2 px-5 inline-flex items-center gap-x-2 text-sm font-medium rounded-xl bg-white text-[#8276a2] hover:bg-[#f9f9fe] hover:text-[#524380] transition-all duration-200 font_outfit disabled:opacity-40 disabled:pointer-events-none shadow-2xs  ">
                            Volver a Usuarios
                        </button>

                        <!-- Botón Guardar Cambios -->
                        <button type="submit" [disabled]="isSubmitting() || (userForm.invalid && userForm.touched)"
                            class="py-2 px-5 inline-flex items-center justify-center gap-x-2 text-sm font-semibold rounded-xl bg-teal-500 text-white transform hover:scale-[1.02] active:scale-95 transition-all duration-200 font_outfit disabled:opacity-40 disabled:pointer-events-none shadow-2xs hover:shadow-md">

                            @if (isSubmitting()) {
                            <div class="animate-spin inline-block size-4 border-2 border-current border-t-transparent rounded-full"
                                role="status" aria-label="loading"></div>
                            <span>Guardando...</span>
                            } @else {
                            <span>Registrar Usuario</span>
                            }
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!-- End Card -->
</div>